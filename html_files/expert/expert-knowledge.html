<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroConnect - Knowledge Base</title>
        <script src="/auth.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            font-family: 'Georgia', serif;
            background: #f7f6ea;
            color: #375432;
        }
        
        .header {
            background: #375432;
            color: #f7f6ea;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.8em;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
        }
        
        .nav-links a {
            color: #f7f6ea;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .nav-links a:hover {
            background: rgba(247, 246, 234, 0.2);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .knowledge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .knowledge-header h2 {
            margin: 0;
            color: #375432;
        }
        
        .add-article-btn {
            background: #375432;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .add-article-btn:hover {
            background: #20301d;
        }
        
        .search-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .search-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            min-width: 300px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #375432;
        }
        
        .search-btn {
            background: #375432;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }
        
        .search-btn:hover {
            background: #20301d;
        }
        
        .filter-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .categories-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .category-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .category-card:hover {
            transform: translateY(-4px);
        }
        
        .category-icon {
            font-size: 2.5em;
            color: #375432;
            margin-bottom: 1rem;
        }
        
        .category-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #375432;
            margin-bottom: 0.5rem;
        }
        
        .category-count {
            color: #666;
            font-size: 0.9em;
        }
        
        .articles-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .articles-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .articles-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #375432;
            margin: 0;
        }
        
        .sort-select {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 6px;
        }
        
        .articles-grid {
            padding: 1.5rem;
            display: grid;
            gap: 1.5rem;
        }
        
        .article-card {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            transition: box-shadow 0.2s;
        }
        
        .article-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .article-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .article-info {
            flex: 1;
        }
        
        .article-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #375432;
            margin-bottom: 0.5rem;
        }
        
        .article-meta {
            display: flex;
            gap: 1rem;
            color: #666;
            font-size: 0.9em;
            flex-wrap: wrap;
        }
        
        .article-category {
            background: #375432;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8em;
        }
        
        .article-content {
            padding: 1.5rem;
        }
        
        .article-summary {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .article-tags {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .article-tag {
            background: #e9ecef;
            color: #495057;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8em;
        }
        
        .article-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s;
        }
        
        .read-btn {
            background: #375432;
            color: white;
        }
        
        .read-btn:hover {
            background: #20301d;
        }
        
        .edit-btn {
            background: #17a2b8;
            color: white;
        }
        
        .edit-btn:hover {
            background: #138496;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        
        .delete-btn:hover {
            background: #c82333;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .modal-title {
            font-size: 1.5em;
            color: #375432;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #375432;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: 'Georgia', serif;
            font-size: 1em;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #375432;
        }
        
        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .submit-btn {
            background: #375432;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            width: 100%;
        }
        
        .submit-btn:hover {
            background: #20301d;
        }
        
        .empty-articles {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }
        
        .empty-articles h3 {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-book"></i> Knowledge Base</h1>
        <div class="nav-links">
            <a href="expert-dashboard.html">← Dashboard</a>
            <a href="expert-consultation.html">Consultations</a>
            <a href="expert-profile.html">Profile</a>
            <button onclick="handleLogout()" style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Logout</button>
        </div>
    </div>

    <div class="container">
        <div class="knowledge-header">
            <h2>Agricultural Knowledge Base</h2>
            <button class="add-article-btn" onclick="showAddArticleModal()">
                <i class="fas fa-plus"></i> Add Article
            </button>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-row">
                <input type="text" class="search-input" id="search-input" placeholder="Search articles, topics, or keywords...">
                <button class="search-btn" onclick="searchArticles()">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
            <div class="filter-row">
                <select class="filter-select" id="category-filter" onchange="filterArticles()">
                    <option value="all">All Categories</option>
                    <option value="Plant Disease">Plant Disease</option>
                    <option value="Soil Management">Soil Management</option>
                    <option value="Pest Control">Pest Control</option>
                    <option value="Crop Management">Crop Management</option>
                    <option value="Irrigation">Irrigation</option>
                    <option value="Fertilizers">Fertilizers</option>
                    <option value="Weather">Weather</option>
                    <option value="Harvesting">Harvesting</option>
                </select>
                <select class="filter-select" id="difficulty-filter" onchange="filterArticles()">
                    <option value="all">All Levels</option>
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                </select>
            </div>
        </div>

        <!-- Categories Section -->
        <div class="categories-section">
            <div class="category-card" onclick="filterByCategory('Plant Disease')">
                <div class="category-icon"><i class="fas fa-leaf"></i></div>
                <div class="category-title">Plant Disease</div>
                <div class="category-count" id="disease-count">0 articles</div>
            </div>
            <div class="category-card" onclick="filterByCategory('Soil Management')">
                <div class="category-icon"><i class="fas fa-seedling"></i></div>
                <div class="category-title">Soil Management</div>
                <div class="category-count" id="soil-count">0 articles</div>
            </div>
            <div class="category-card" onclick="filterByCategory('Pest Control')">
                <div class="category-icon"><i class="fas fa-bug"></i></div>
                <div class="category-title">Pest Control</div>
                <div class="category-count" id="pest-count">0 articles</div>
            </div>
            <div class="category-card" onclick="filterByCategory('Crop Management')">
                <div class="category-icon"><i class="fas fa-wheat-awn"></i></div>
                <div class="category-title">Crop Management</div>
                <div class="category-count" id="crop-count">0 articles</div>
            </div>
            <div class="category-card" onclick="filterByCategory('Irrigation')">
                <div class="category-icon"><i class="fas fa-tint"></i></div>
                <div class="category-title">Irrigation</div>
                <div class="category-count" id="irrigation-count">0 articles</div>
            </div>
            <div class="category-card" onclick="filterByCategory('Fertilizers')">
                <div class="category-icon"><i class="fas fa-flask"></i></div>
                <div class="category-title">Fertilizers</div>
                <div class="category-count" id="fertilizer-count">0 articles</div>
            </div>
        </div>

        <!-- Articles Section -->
        <div class="articles-section">
            <div class="articles-header">
                <h3 class="articles-title">Knowledge Articles</h3>
                <select class="sort-select" id="sort-select" onchange="sortArticles()">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="title">Title A-Z</option>
                    <option value="category">Category</option>
                </select>
            </div>
            <div id="articles-grid" class="articles-grid">
                <!-- Articles will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add/Edit Article Modal -->
    <div id="article-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Add New Article</h3>
                <button class="close-btn" onclick="closeArticleModal()">&times;</button>
            </div>
            <form id="article-form" onsubmit="handleArticleSubmit(event)">
                <div class="form-group">
                    <label for="article-title">Article Title *</label>
                    <input type="text" id="article-title" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="article-category">Category *</label>
                        <select id="article-category" required>
                            <option value="">Select Category</option>
                            <option value="Plant Disease">Plant Disease</option>
                            <option value="Soil Management">Soil Management</option>
                            <option value="Pest Control">Pest Control</option>
                            <option value="Crop Management">Crop Management</option>
                            <option value="Irrigation">Irrigation</option>
                            <option value="Fertilizers">Fertilizers</option>
                            <option value="Weather">Weather</option>
                            <option value="Harvesting">Harvesting</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="article-difficulty">Difficulty Level *</label>
                        <select id="article-difficulty" required>
                            <option value="">Select Level</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="article-summary">Summary *</label>
                    <textarea id="article-summary" rows="3" required placeholder="Brief summary of the article..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="article-content">Content *</label>
                    <textarea id="article-content" required placeholder="Write your detailed article content here..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="article-tags">Tags (comma-separated)</label>
                    <input type="text" id="article-tags" placeholder="e.g., organic, disease, treatment, prevention">
                </div>
                
                <button type="submit" class="submit-btn">Save Article</button>
            </form>
        </div>
    </div>

    <script>
        let currentFilter = { category: 'all', difficulty: 'all', search: '' };
        let currentSort = 'newest';

        // Mock articles data
        function generateMockArticles() {
            const user = getCurrentUser();
            if (!user || user.role !== 'expert') return [];
            
            const articlesKey = `expert_articles_${user.id}`;
            let articles = JSON.parse(localStorage.getItem(articlesKey) || '[]');
            
            // Generate some mock articles if none exist
            if (articles.length === 0) {
                const mockArticles = [
                    {
                        id: Date.now() - 86400000,
                        title: 'Common Tomato Diseases and Their Treatment',
                        category: 'Plant Disease',
                        difficulty: 'intermediate',
                        summary: 'Learn to identify and treat the most common diseases affecting tomato plants, including early blight, late blight, and bacterial wilt.',
                        content: 'Tomato plants are susceptible to various diseases that can significantly impact yield and quality. Early blight, caused by Alternaria solani, appears as dark spots with concentric rings on older leaves. Treatment involves removing affected leaves and applying copper-based fungicides. Late blight, caused by Phytophthora infestans, creates water-soaked lesions that quickly spread. Prevention through proper spacing and fungicide application is crucial. Bacterial wilt causes sudden wilting and yellowing, requiring removal of affected plants and soil sterilization.',
                        tags: ['tomato', 'disease', 'treatment', 'fungicide', 'prevention'],
                        authorId: user.id,
                        authorName: user.details?.full_name || user.username,
                        createdAt: new Date(Date.now() - 86400000).toISOString(),
                        updatedAt: new Date(Date.now() - 86400000).toISOString(),
                        views: 245,
                        likes: 18
                    },
                    {
                        id: Date.now() - 172800000,
                        title: 'Soil pH Management for Optimal Crop Growth',
                        category: 'Soil Management',
                        difficulty: 'beginner',
                        summary: 'Understanding soil pH and its impact on nutrient availability. Learn how to test, adjust, and maintain optimal pH levels for different crops.',
                        content: 'Soil pH is a critical factor affecting nutrient availability and plant health. Most crops prefer slightly acidic to neutral pH (6.0-7.0). Testing soil pH using digital meters or test strips provides accurate readings. To lower pH, add organic matter like compost, peat moss, or sulfur. To raise pH, apply lime or wood ash. Regular monitoring and gradual adjustments ensure optimal growing conditions. Different crops have varying pH preferences - blueberries prefer acidic soil (4.5-5.5), while brassicas thrive in slightly alkaline conditions (6.5-7.5).',
                        tags: ['soil', 'pH', 'nutrients', 'testing', 'amendment'],
                        authorId: user.id,
                        authorName: user.details?.full_name || user.username,
                        createdAt: new Date(Date.now() - 172800000).toISOString(),
                        updatedAt: new Date(Date.now() - 172800000).toISOString(),
                        views: 189,
                        likes: 23
                    },
                    {
                        id: Date.now() - 259200000,
                        title: 'Integrated Pest Management for Sustainable Agriculture',
                        category: 'Pest Control',
                        difficulty: 'advanced',
                        summary: 'Comprehensive guide to IPM strategies combining biological, cultural, and chemical controls for effective and sustainable pest management.',
                        content: 'Integrated Pest Management (IPM) combines multiple strategies to control pests while minimizing environmental impact. Biological control uses natural predators like ladybugs for aphids and parasitic wasps for caterpillars. Cultural practices include crop rotation, companion planting, and proper sanitation. Mechanical controls involve traps, barriers, and physical removal. Chemical controls should be used as a last resort, selecting targeted, low-toxicity options. Regular monitoring and threshold-based decision making ensure interventions occur only when necessary. IPM reduces pesticide resistance, protects beneficial insects, and maintains ecosystem balance.',
                        tags: ['IPM', 'biological control', 'sustainable', 'pesticides', 'ecosystem'],
                        authorId: user.id,
                        authorName: user.details?.full_name || user.username,
                        createdAt: new Date(Date.now() - 259200000).toISOString(),
                        updatedAt: new Date(Date.now() - 259200000).toISOString(),
                        views: 156,
                        likes: 31
                    }
                ];
                
                localStorage.setItem(articlesKey, JSON.stringify(mockArticles));
                articles = mockArticles;
            }
            
            return articles;
        }

        function getArticles() {
            return generateMockArticles();
        }

        function saveArticles(articles) {
            const user = getCurrentUser();
            if (!user || user.role !== 'expert') return false;
            
            const articlesKey = `expert_articles_${user.id}`;
            localStorage.setItem(articlesKey, JSON.stringify(articles));
            return true;
        }

        function displayArticles(articles = null) {
            const allArticles = articles || getArticles();
            const articlesGrid = document.getElementById('articles-grid');
            
            if (allArticles.length === 0) {
                articlesGrid.innerHTML = `
                    <div class="empty-articles">
                        <h3>No articles yet</h3>
                        <p>Start building your knowledge base by adding your first article!</p>
                        <button class="add-article-btn" onclick="showAddArticleModal()">
                            <i class="fas fa-plus"></i> Add First Article
                        </button>
                    </div>
                `;
                return;
            }
            
            const articlesHTML = allArticles.map(article => {
                const createdDate = new Date(article.createdAt).toLocaleDateString();
                const tagsHTML = article.tags.map(tag => `
                    <span class="article-tag">${tag}</span>
                `).join('');
                
                return `
                    <div class="article-card">
                        <div class="article-header">
                            <div class="article-info">
                                <div class="article-title">${article.title}</div>
                                <div class="article-meta">
                                    <span><i class="fas fa-user"></i> ${article.authorName}</span>
                                    <span><i class="fas fa-calendar"></i> ${createdDate}</span>
                                    <span><i class="fas fa-eye"></i> ${article.views} views</span>
                                    <span><i class="fas fa-heart"></i> ${article.likes} likes</span>
                                    <span><i class="fas fa-signal"></i> ${article.difficulty}</span>
                                </div>
                            </div>
                            <div class="article-category">${article.category}</div>
                        </div>
                        <div class="article-content">
                            <div class="article-summary">${article.summary}</div>
                            <div class="article-tags">${tagsHTML}</div>
                            <div class="article-actions">
                                <button class="action-btn read-btn" onclick="readArticle(${article.id})">
                                    <i class="fas fa-book-open"></i> Read
                                </button>
                                <button class="action-btn edit-btn" onclick="editArticle(${article.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteArticle(${article.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            articlesGrid.innerHTML = articlesHTML;
            updateCategoryCounts();
        }

        function updateCategoryCounts() {
            const articles = getArticles();
            const categories = ['Plant Disease', 'Soil Management', 'Pest Control', 'Crop Management', 'Irrigation', 'Fertilizers'];
            const counts = {};
            
            categories.forEach(category => {
                counts[category] = articles.filter(article => article.category === category).length;
            });
            
            document.getElementById('disease-count').textContent = `${counts['Plant Disease']} articles`;
            document.getElementById('soil-count').textContent = `${counts['Soil Management']} articles`;
            document.getElementById('pest-count').textContent = `${counts['Pest Control']} articles`;
            document.getElementById('crop-count').textContent = `${counts['Crop Management']} articles`;
            document.getElementById('irrigation-count').textContent = `${counts['Irrigation']} articles`;
            document.getElementById('fertilizer-count').textContent = `${counts['Fertilizers']} articles`;
        }

        function filterArticles() {
            const categoryFilter = document.getElementById('category-filter').value;
            const difficultyFilter = document.getElementById('difficulty-filter').value;
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            currentFilter = { category: categoryFilter, difficulty: difficultyFilter, search: searchTerm };
            
            let articles = getArticles();
            
            // Apply filters
            if (categoryFilter !== 'all') {
                articles = articles.filter(article => article.category === categoryFilter);
            }
            
            if (difficultyFilter !== 'all') {
                articles = articles.filter(article => article.difficulty === difficultyFilter);
            }
            
            if (searchTerm) {
                articles = articles.filter(article =>
                    article.title.toLowerCase().includes(searchTerm) ||
                    article.summary.toLowerCase().includes(searchTerm) ||
                    article.content.toLowerCase().includes(searchTerm) ||
                    article.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                );
            }
            
            // Apply sorting
            articles = sortArticlesList(articles, currentSort);
            
            displayArticles(articles);
        }

        function filterByCategory(category) {
            document.getElementById('category-filter').value = category;
            filterArticles();
        }

        function searchArticles() {
            filterArticles();
        }

        function sortArticles() {
            currentSort = document.getElementById('sort-select').value;
            filterArticles();
        }

        function sortArticlesList(articles, sortBy) {
            switch (sortBy) {
                case 'newest':
                    return articles.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                case 'oldest':
                    return articles.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                case 'title':
                    return articles.sort((a, b) => a.title.localeCompare(b.title));
                case 'category':
                    return articles.sort((a, b) => a.category.localeCompare(b.category));
                default:
                    return articles;
            }
        }

        function showAddArticleModal() {
            const modal = document.getElementById('article-modal');
            const form = document.getElementById('article-form');
            const title = document.getElementById('modal-title');
            
            title.textContent = 'Add New Article';
            form.reset();
            form.dataset.mode = 'add';
            modal.style.display = 'block';
        }

        function editArticle(articleId) {
            const articles = getArticles();
            const article = articles.find(a => a.id === articleId);
            if (!article) return;
            
            const modal = document.getElementById('article-modal');
            const form = document.getElementById('article-form');
            const title = document.getElementById('modal-title');
            
            title.textContent = 'Edit Article';
            form.dataset.mode = 'edit';
            form.dataset.articleId = articleId;
            
            // Fill form with article data
            document.getElementById('article-title').value = article.title;
            document.getElementById('article-category').value = article.category;
            document.getElementById('article-difficulty').value = article.difficulty;
            document.getElementById('article-summary').value = article.summary;
            document.getElementById('article-content').value = article.content;
            document.getElementById('article-tags').value = article.tags.join(', ');
            
            modal.style.display = 'block';
        }

        function readArticle(articleId) {
            const articles = getArticles();
            const article = articles.find(a => a.id === articleId);
            if (!article) return;
            
            // Increment view count
            article.views += 1;
            saveArticles(articles);
            
            // Show article content (in a real app, this would open a dedicated page)
            alert(`${article.title}\n\nCategory: ${article.category}\nDifficulty: ${article.difficulty}\nAuthor: ${article.authorName}\n\n${article.content}`);
            
            // Refresh display to show updated view count
            filterArticles();
        }

        function deleteArticle(articleId) {
            const articles = getArticles();
            const article = articles.find(a => a.id === articleId);
            if (!article) return;
            
            if (!confirm(`Are you sure you want to delete "${article.title}"?`)) return;
            
            const filteredArticles = articles.filter(a => a.id !== articleId);
            saveArticles(filteredArticles);
            filterArticles();
            showNotification('Article deleted successfully!', 'success');
        }

        function handleArticleSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const mode = form.dataset.mode;
            const articleId = parseInt(form.dataset.articleId);
            
            const articleData = {
                title: document.getElementById('article-title').value,
                category: document.getElementById('article-category').value,
                difficulty: document.getElementById('article-difficulty').value,
                summary: document.getElementById('article-summary').value,
                content: document.getElementById('article-content').value,
                tags: document.getElementById('article-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
            };
            
            const articles = getArticles();
            const user = getCurrentUser();
            
            if (mode === 'add') {
                const newArticle = {
                    id: Date.now(),
                    ...articleData,
                    authorId: user.id,
                    authorName: user.details?.full_name || user.username,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    views: 0,
                    likes: 0
                };
                articles.push(newArticle);
            } else if (mode === 'edit') {
                const articleIndex = articles.findIndex(a => a.id === articleId);
                if (articleIndex !== -1) {
                    articles[articleIndex] = {
                        ...articles[articleIndex],
                        ...articleData,
                        updatedAt: new Date().toISOString()
                    };
                }
            }
            
            saveArticles(articles);
            closeArticleModal();
            filterArticles();
            showNotification(mode === 'add' ? 'Article added successfully!' : 'Article updated successfully!', 'success');
        }

        function closeArticleModal() {
            document.getElementById('article-modal').style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 6px;
                color: white;
                font-weight: 600;
                z-index: 1001;
                ${type === 'success' ? 'background: #28a745;' : ''}
                ${type === 'error' ? 'background: #dc3545;' : ''}
                ${type === 'info' ? 'background: #17a2b8;' : ''}
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                showNotification('Logged out successfully!', 'success');
                setTimeout(() => {
                    window.location.href = '/html_files/auth/login.html';
                }, 1500);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const user = getCurrentUser();
            if (!user || user.role !== 'expert') {
                window.location.href = '/html_files/auth/login.html';
                return;
            }
            
            displayArticles();
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('article-modal');
            if (event.target === modal) {
                closeArticleModal();
            }
        });

        // Search on Enter key
        document.getElementById('search-input').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                searchArticles();
            }
        });
    </script>
</body>
</html>