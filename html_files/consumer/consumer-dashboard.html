<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AgroConnect ‚Äì Consumer Dashboard</title>
  <style>
    body { margin: 0; font-family: 'Georgia', serif; background: #f7f6ea; color: #375432; position: relative; }
    .fruit-images { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:.3; }
    .fruit-img { position:absolute; opacity:.5; animation: gentleFloat 10s ease-in-out infinite; }
    .fruit1 { left:60px; top:35px; width:40px; animation-delay:0s; }
    .fruit2 { right:80px; top:48px; width:40px; animation-delay:2s; }
    .fruit3 { left:17px; bottom:80px; width:50px; animation-delay:4s; }
    .fruit4 { right:45px; bottom:65px; width:50px; animation-delay:6s; }
    .fruit5 { left:32px; top:230px; width:40px; animation-delay:8s; }
    .fruit6 { right:56px; top:260px; width:35px; animation-delay:1s; }
    @keyframes gentleFloat { 0%,100%{transform:translateY(0) rotate(0)} 33%{transform:translateY(-6px) rotate(1deg)} 66%{transform:translateY(-2px) rotate(-.5deg)} }
    @keyframes slideInLeft { from{opacity:0; transform:translateX(-100%)} to{opacity:1; transform:translateX(0)} }
    @keyframes fadeInRight { from{opacity:0; transform:translateX(30px)} to{opacity:1; transform:translateX(0)} }
    @keyframes bounceIn { 0%{opacity:0; transform:scale(.3) translateY(50px)} 50%{opacity:1; transform:scale(1.05) translateY(-10px)} 70%{transform:scale(.95) translateY(0)} 100%{opacity:1; transform:scale(1) translateY(0)} }
    .sidebar { position:fixed; left:0; top:0; bottom:0; width:235px; background:#375432; padding:0; display:flex; flex-direction:column; justify-content:space-between; z-index:10; animation: slideInLeft .7s ease-out; }
    .sidebar .brand { font-size:1.5em; font-weight:bold; color:#f7f6ea; padding:26px 28px 22px; letter-spacing:1px; }
    .nav-list { flex:1; }
    .nav-section { margin-top:6px; }
    .nav-section a { display:flex; align-items:center; padding:12px 32px; text-decoration:none; color:#f7f6ea; transition: background .13s; font-size:1.06em; border-radius:8px; margin:4px 8px; gap:.9em; }
    .nav-section a.active, .nav-section a:hover { background:#20301d; color:#f7f6ea; }
    .sidebar .settings { border-top:1px solid rgba(247,246,234,.2); margin:0 18px; color:#f7f6ea; font-size:1.07em; padding:19px 12px 5px 34px; display:flex; align-items:center; gap:8px; opacity:.8; }
    .profile { display:flex; align-items:center; gap:12px; padding:13px 22px 16px 32px; border-top:1px solid rgba(247,246,234,.2); background: rgba(55,84,50,.1); }
    .avatar { width:40px; height:40px; border-radius:50%; object-fit:cover; background:#eaf6ee; }
    .profile-details { display:flex; flex-direction:column; color:#f7f6ea; font-size:1em; }
    .profile-details .role { font-size:.87em; color:#f7f6ea; opacity:.8; }
    .logout-section { padding:12px 22px 16px 22px; border-top:1px solid rgba(247,246,234,.2); }
    .logout-btn { background:#dc3545; color:white; border:none; padding:8px 16px; border-radius:4px; cursor:pointer; font-size:14px; width:100%; transition:background .2s; display:flex; align-items:center; justify-content:center; gap:8px; }
    .logout-btn:hover { background:#c82333; }
    .user-welcome { display:flex; justify-content:space-between; align-items:center; background:#fff; padding:12px 20px; border-radius:8px; margin-bottom:20px; box-shadow:0 2px 4px rgba(55,84,50,.1); }
    .welcome-text { color:#375432; font-size:1.1em; }
    .welcome-text .user-name { font-weight:600; color:#375432; }
    .main-content { margin-left:235px; padding:36px 42px 30px; min-height:100vh; background:#f7f6ea; position:relative; z-index:5; animation: fadeInRight .8s ease-out .2s both; max-width:1200px; }
    .dashboard-title { font-size:2em; font-weight:bold; margin:0 0 16px; color:#375432; }
    .hero { background:#fff; border-radius:12px; padding:20px 24px; box-shadow:0 2px 8px rgba(55,84,50,.12); margin-bottom:18px; }
    .hero-sub { margin-top:6px; color:#4c6b54; font-size:1.02em; }
    .toolbar { position:sticky; top:0; z-index:8; background:#f7f6ea; padding:10px 0 14px; backdrop-filter:saturate(180%) blur(2px); }
    .search-row { display:flex; align-items:center; margin:16px 0 32px; gap:18px; }
    .search-row input { flex:1; padding:14px 18px; border:1.5px solid #86b691; border-radius:9px; font-size:1.1em; background:#ffffff; transition:border-color .2s; }
    .search-row input:focus { border-color:#36b94a; outline:none; }
    .search-row button { background:#408a46; color:#fff; border:none; padding:11px 30px; border-radius:9px; font-size:1.09em; cursor:pointer; font-weight:600; transition: background .18s; }
    .search-row button:hover { background:#25632a; }
    .main-content h3 { margin:24px 0 12px; font-size:1.21em; font-weight:700; color:#29462c; letter-spacing:.2px; }
    .categories { display:flex; gap:12px; margin:8px 0 10px; flex-wrap:wrap; overflow-x:auto; padding-bottom:6px; }
    .category-card { background:#f6fff4; border:1.5px solid #d2fad1; border-radius:999px; height:auto; display:inline-flex; align-items:center; justify-content:center; font-size:1em; color:#33823d; font-weight:600; cursor:pointer; transition:border .18s, background .17s; padding:8px 14px; min-width:auto; }
    .category-card:hover { border:1.5px solid #46cf45; background:#eefbea; }
    .category-card .category-icon { font-size:1.3em; margin-right:8px; color:#36b94a; }
    .products-row { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:22px; }
    .product-card { background:#fff; border-radius:17px; box-shadow:0 2px 8px #17741014; padding:0 0 18px 0; transition: box-shadow .18s, transform .19s; display:flex; flex-direction:column; align-items:center; }
    .product-card img { width:100%; height:115px; border-top-left-radius:17px; border-top-right-radius:17px; object-fit:cover; background:#f6fff4; }
    .product-desc { padding:11px 17px 2px; min-height:79px; width:100%; box-sizing:border-box; text-align:center; }
    .product-title { font-weight:bold; font-size:1.08em; margin-bottom:7px; }
    .product-price { color:#36b94a; font-weight:600; font-size:1.01em; margin-bottom:6px; }
    .add-btn { background:#e6fbe3; color:#25632a; border:1.4px solid #98e59d; padding:7px 0; border-radius:8px; width:88%; font-size:1em; transition: background .13s, color .13s; margin-top:5px; cursor:pointer; }
    .add-btn:hover { background:#25632a; color:#fff; border-color:#25632a; }
    @media (max-width: 1000px) { .main-content { padding:25px 7vw 30px; } .sidebar { width:170px; } .main-content { margin-left:170px; } .product-card img { height:94px; } }
    @media (max-width: 700px) { .sidebar { display:none; } .main-content { margin-left:0; padding:17px 3vw; } .products-row { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); } }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="/auth.js"></script>
  <script src="/consumer-products.js"></script>
  <script src="/components/components.js"></script>
</head>
<body>
  <!-- Decorative fruit images -->
  <div class="fruit-images">
    <img src="/images/cherries.png" alt="Cherries" class="fruit-img fruit1"/>
    <img src="/images/peach.png" alt="Pear" class="fruit-img fruit2"/>
    <img src="/images/cherries.png" alt="Orange" class="fruit-img fruit3"/>
    <img src="/images/peach.png" alt="Peach" class="fruit-img fruit4"/>
    <img src="/images/cherries.png" alt="Papaya" class="fruit-img fruit5"/>
    <img src="/images/peach.png" alt="Grapes" class="fruit-img fruit6"/>
  </div>
  
  <div id="sidebar-placeholder"></div>
  <main class="main-content">
    <div id="user-info" class="user-welcome" style="display: none;">
      <div class="welcome-text">
        Welcome back, <span class="user-name" id="welcome-user-name">User</span>!
      </div>
      <div>
        <button class="logout-btn" onclick="handleLogout()">Logout</button>
      </div>
    </div>

    <section class="hero">
      <div class="dashboard-title">Consumer Dashboard</div>
      <div class="hero-sub">Discover fresh, locally sourced produce and shop smarter.</div>
    </section>
    <div class="toolbar">
      <form class="search-row">
        <input type="text" placeholder="Search fresh products by name, category, or farmer..." />
        <button type="submit"><i class="fas fa-search"></i> Search</button>
      </form>
      <div class="categories" aria-label="Browse by category">
        <div class="category-card"><div class="category-icon">ü•ï</div>Vegetables</div>
        <div class="category-card"><div class="category-icon">üçé</div>Fruits</div>
        <div class="category-card"><div class="category-icon">ü•õ</div>Dairy</div>
        <div class="category-card"><div class="category-icon">üåæ</div>Grains</div>
        <div class="category-card"><div class="category-icon">üåø</div>Herbs</div>
      </div>
    </div>

    <section>
      <h3 id="featured-heading">Featured Products</h3>
      <div class="products-row"></div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      loadSidebar('consumer');
      // Load data and products
      await loadUserDataForConsumer();
      displayProductsForConsumers();

      // Search hook
      const searchForm = document.querySelector('.search-row');
      const searchInput = searchForm?.querySelector('input');
      if (searchForm && searchInput) {
        searchForm.addEventListener('submit', function(e){
          e.preventDefault();
          const q = searchInput.value.trim();
          if (q) searchProducts(q); else { displayProductsForConsumers(); const h=document.getElementById('featured-heading'); if(h) h.textContent='Featured Products'; }
        });
      }

      // Category filters
      document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', function(){
          const text = this.textContent.trim();
          let cat = 'all';
          if (text.includes('Vegetables')) cat='Vegetables';
          else if (text.includes('Fruits')) cat='Fruits';
          else if (text.includes('Dairy')) cat='Dairy';
          else if (text.includes('Grains')) cat='Grains';
          filterProductsByCategory(cat);
        });
      });
    });
  </script>
</body>
</html>